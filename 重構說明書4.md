預測演算法重構企劃書 step 4

1. 總體目標
   在前三階段的重構成功奠定了核心功能與架構的基礎上，本階段的目標是將系統從「功能完整」提升至「產品級」水準。我們將專注於清理技術債、優化系統性能、並建立完善的監控與文件體系，確保系統能夠長期穩定地運行，並讓未來的開發與維護工作更加高效。

2. 核心工作項目 (Epic)
   2.1. 技術債清理與程式碼品質提升 (Debt Cleanup & Code Quality)
   目標： 移除所有過時程式碼，統一程式碼風格，提升專案的可維護性。

具體行動：

移除舊版 API：

任務： 徹底移除 routes/api.php 中定義的所有 v1 API 路由與相關的 Controller 邏輯。

驗收標準： 專案中不再有任何對舊版 API 的引用，v1 API 端點回傳 404 錯誤。

程式碼風格一致化：

任務： 引入 PHP-CS-Fixer 或類似工具，定義團隊統一的 PSR-12 程式碼風格，並將其整合進 CI/CD 流程。對現有程式碼庫進行一次全面的格式化。

驗收標準： 新的提交若不符合程式碼風格，將無法通過 CI 檢查。

靜態程式碼分析：

任務： 引入 PHPStan 或 Psalm 進行靜態分析，設定合理的分析級別，並修復所有發現的類型錯誤或潛在 bug。

驗收標準： 專案的靜態分析錯誤數量降至零。

前端依賴清理：

任務： 審核 package.json，移除不再使用的 npm 套件，並將所有仍在使用的套件升級至最新的穩定版本。

驗收標準： npm audit 無重大安全漏洞，移除至少 10% 的無用依賴。

2.2. 系統性能與可擴展性優化 (Performance & Scalability)
目標： 提升系統在高負載下的回應速度與處理能力，為未來的用戶增長做準備。

具體行動：

資料庫查詢優化：

任務： 使用 Laravel Telescope 或類似工具分析慢查詢，特別是 PredictionResult 和 BacktestReport 相關的查詢。為常用查詢欄位（如 strategy_name, created_at）添加資料庫索引。

驗收標準： 主要 API 端點的資料庫查詢時間減少 30% 以上。

快取策略增強：

任務： 對於不常變動但查詢頻繁的數據（如策略列表 listStrategies）引入 Redis 快取。

驗收標準： listStrategies API 的平均回應時間低於 50ms。

非同步任務隊列優化：

任務： 將 Laravel Horizon 引入專案，以提供更佳的隊列監控與管理界面。根據任務類型（如 RunBacktestJob vs. SendNotificationJob）配置不同的優先級隊列。

驗收標準： Horizon 儀表板可以清晰地監控隊列狀態，高優先級任務不會被低優先級任務阻塞。
