# ShowCurrentStrategy 命令完整指南

## 📖 概述

`ShowCurrentStrategy` 命令已经全面升级，现在可以展示加密货币预测系统的完整状态，包括策略参数、调度系统、市场监控、队列状态、系统性能等所有可展示的实时更新参数。

## 🚀 命令语法

```bash
# 基础显示
php artisan strategy:show-current

# 显示详细信息
php artisan strategy:show-current --detailed

# 显示实时状态
php artisan strategy:show-current --real-time

# 显示监控数据
php artisan strategy:show-current --monitoring

# 组合使用
php artisan strategy:show-current --detailed --real-time --monitoring
```

## 📊 显示内容详解

### 1. 策略基本信息 (📊)

- **策略名称**: 当前活跃策略的名称
- **回测ID**: 生成该策略的回测运行ID
- **策略分数**: 策略的评分 (0-100)
- **激活时间**: 策略激活的时间戳
- **运行时长**: 策略运行的时间长度
- **创建时间**: 策略创建的时间戳

### 2. 当前参数配置 (⚙️)

显示当前策略的核心参数：

- `elo_weight`: Elo评分权重 (0-1)
- `momentum_weight`: 动能评分权重 (0-1)
- `h2h_min_games_threshold`: 最小对局数阈值
- `enhanced_stability_penalty`: 稳定性惩罚系数

### 3. 调度系统状态 (🕐)

#### 最近回测记录

显示最近5次回测的执行状态：

- ✅ 已完成
- 🔄 运行中
- ❌ 失败
- ❓ 未知状态

#### 调度任务配置

展示所有定时任务的执行频率：

- **超快速回测**: 每2小时 (120局)
- **快速回测**: 每4小时 (240局)
- **标准回测**: 每8小时 (480局)
- **全面回测**: 每日 (1200局)
- **实时策略晋升**: 每3小时 (门槛48分)
- **快速策略晋升**: 每6小时 (门槛52分)
- **标准策略晋升**: 每12小时 (门槛58分)
- **价格更新**: 每分钟
- **动能计算**: 每2分钟 (实时) + 每5分钟 (兜底)
- **市场监控**: 每5分钟
- **队列监控**: 每5分钟
- **系统监控**: 每30分钟
- **健康报告**: 每小时

### 4. 市场监控数据 (📈)

#### 游戏数据统计

- **最近1小时**: 最近1小时的游戏局数
- **今日**: 今日总游戏局数
- **本周**: 本周总游戏局数
- **预期小时率**: 60局/小时 (标准)
- **活跃度比例**: 实际/预期的比例

#### 市场活跃度

- **最近10分钟**: 最近10分钟的游戏局数
- **正常范围**: 8-12局/10分钟
- **状态**: 正常/异常

#### 价格数据统计

- **最近1小时价格记录**: 价格更新记录数
- **活跃代币数量**: 活跃的代币数量

### 5. 队列状态 (🔄)

#### 队列积压情况

- **回测队列**: 回测任务积压数量
- **高优先级队列**: 高优先级任务积压数量
- **默认队列**: 默认任务积压数量
- **失败任务**: 失败任务数量

#### 队列健康状态

- **回测队列**: 正常/轻微积压/积压严重
- **高优先级队列**: 正常/轻微积压/积压严重
- **失败任务**: 正常/失败过多

### 6. 系统性能 (💻)

#### 内存使用

- **当前使用**: 当前内存使用量 (MB)
- **峰值使用**: 峰值内存使用量 (MB)
- **内存限制**: PHP内存限制

#### 磁盘使用

- **已使用**: 磁盘使用百分比
- **剩余空间**: 剩余磁盘空间 (GB)
- **总空间**: 总磁盘空间 (GB)

### 7. 缓存状态 (💾)

#### 缓存项目

- **策略参数**: 策略参数缓存状态
- **动能数据**: 动能数据缓存状态
- **预测结果**: 预测结果缓存状态

#### 缓存配置

- **策略缓存键**: 缓存键名
- **性能缓存TTL**: 性能缓存过期时间
- **预测缓存TTL**: 预测缓存过期时间

## 🔍 详细模式 (--detailed)

### 参数网格配置

显示回测参数网格的所有可能取值：

- `elo_weight`: [0.4, 0.5, 0.6, 0.7]
- `momentum_weight`: [0.6, 0.5, 0.4, 0.3]
- `h2h_min_games_threshold`: [3, 5]
- `enhanced_stability_penalty`: [0.1, 0.25, 0.5]

### 晋升门槛

显示策略晋升的最低要求：

- `min_breakeven_rate`: 65 (最低保本率)
- `min_total_trades_ratio`: 0.4 (最低出手频次比例)

### 预测策略配置

显示所有可用的预测策略：

- **conservative**: 保守型策略
- **aggressive**: 进攻型策略
- **balanced**: 平衡型策略
- **momentum**: 动量策略
- **elo**: Elo评分策略
- **volume_weighted**: 交易量加权策略

### 其他策略

显示最近5个非活跃策略的状态。

## 🔄 实时状态模式 (--real-time)

### 最近活动

显示系统最近的活动记录：

- 回测完成时间
- 新游戏创建时间
- 价格更新时间

### 系统状态

- **当前时间**: 系统当前时间
- **系统运行**: 系统运行时长
- **PHP版本**: PHP版本号
- **Laravel版本**: Laravel框架版本

## 📊 监控数据模式 (--monitoring)

### 系统健康报告

按类别显示系统健康指标：

#### 市场活跃度

- **小时游戏数**: 最近1小时游戏数
- **活跃度比例**: 实际/预期比例
- **状态**: 正常/异常

#### 策略状态

- **活跃策略**: 当前活跃策略名称
- **策略分数**: 策略评分
- **运行时长**: 策略运行时间

#### 优化活动

- **6小时回测数**: 最近6小时回测次数
- **回测队列**: 队列积压数量
- **失败任务**: 失败任务数量

#### 系统健康

- **内存使用**: 内存使用量
- **磁盘使用**: 磁盘使用百分比
- **队列状态**: 队列健康状态

### 异常检测

自动检测并报告系统异常：

- 市场活跃度异常 (过高/过低)
- 队列积压严重
- 失败任务过多
- 系统资源使用异常

## 🎯 使用场景

### 1. 日常监控

```bash
php artisan strategy:show-current
```

快速查看系统整体状态，适合日常监控。

### 2. 问题诊断

```bash
php artisan strategy:show-current --monitoring
```

当系统出现问题时，使用监控模式快速定位问题。

### 3. 配置检查

```bash
php artisan strategy:show-current --detailed
```

检查策略配置和参数设置是否正确。

### 4. 实时监控

```bash
php artisan strategy:show-current --real-time --monitoring
```

实时监控系统状态，适合运维人员使用。

## 📈 输出示例

### 正常状态输出

```
🔍 查询当前活跃策略和系统状态...

📊 策略基本信息:
  策略名称: Strategy_E0.5_M0.5_S41.3_20250718_1628
  策略分数: 41.3444
  运行时长: 9 小时前

🕐 调度系统状态:
⏰ 调度任务配置:
  超快速回测: 每2小时 (120局)
  价格更新: 每分钟
  动能计算: 每2分钟 (实时) + 每5分钟 (兜底)

📈 市场监控数据:
🎮 游戏数据统计:
  最近1小时: 60 局
  活跃度比例: 1.0

📊 市场活跃度:
  ✅ 最近10分钟: 10 局 (正常)

🔄 队列状态:
🏥 队列健康状态:
  回测队列: ✅ 正常
  高优先级队列: ✅ 正常
  失败任务: ✅ 正常

💻 系统性能:
🧠 内存使用:
  当前使用: 32 MB
  内存限制: 128M

💾 磁盘使用:
  已使用: 72.38%
  剩余空间: 255.88 GB
```

### 异常状态输出

```
⚠️  检测到异常:
  - 市场活跃度异常低 (0 局/小时)
  - 回测队列积压严重 (24 个任务)
```

## 🔧 故障排除

### 常见问题

1. **策略参数未缓存**

   - 检查缓存服务是否正常运行
   - 手动触发策略缓存更新

2. **队列积压严重**

   - 检查队列处理器是否正常运行
   - 考虑增加队列处理器数量
   - 检查任务执行是否有错误

3. **市场活跃度异常**

   - 检查游戏数据源是否正常
   - 验证数据采集任务是否正常运行

4. **系统资源使用异常**
   - 检查内存和磁盘使用情况
   - 考虑优化数据库查询
   - 清理不必要的缓存数据

## 📝 总结

更新后的 `ShowCurrentStrategy` 命令提供了完整的系统状态监控功能，涵盖了：

- ✅ 策略参数和配置
- ✅ 调度系统状态
- ✅ 市场监控数据
- ✅ 队列健康状态
- ✅ 系统性能指标
- ✅ 缓存状态
- ✅ 异常检测和告警

这个命令现在是一个强大的系统监控工具，可以帮助运维人员快速了解系统状态，及时发现和解决问题。
